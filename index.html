<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Заповнення Бланка</title>
</head>
<body>
  <h1>Заповнення Бланка</h1>
  <form id="form">
    <h3>Ship From:</h3>
    <label>Address:</label>
    <input type="text" id="shipFromAddress" placeholder="Enter address"><br>
    <label>City/State/Zip:</label>
    <input type="text" id="shipFromCity" placeholder="Enter city/state/zip"><br>
    <label>Name:</label>
    <input type="text" id="shipFromName" placeholder="Enter name"><br>
    <label>SID#:</label>
    <input type="text" id="shipFromSID" placeholder="Enter SID#"><br>

    <h3>Ship To:</h3>
    <label>Address:</label>
    <input type="text" id="shipToAddress" placeholder="Enter address"><br>
    <label>City/State/Zip:</label>
    <input type="text" id="shipToCity" placeholder="Enter city/state/zip"><br>
    <label>Name:</label>
    <input type="text" id="shipToName" placeholder="Enter name"><br>
    <label>SID#:</label>
    <input type="text" id="shipToSID" placeholder="Enter SID#"><br>

    <h3>Additional Information:</h3>
    <label>Packages (PKGS):</label>
    <input type="text" id="pkgs" placeholder="Enter number of packages"><br>
    <label>Weight:</label>
    <input type="text" id="weight" placeholder="Enter weight"><br>
    <label>Shipper Information:</label>
    <input type="text" id="shipperInfo" placeholder="Enter shipper info"><br>
    <label>Bill of Lading Number:</label>
    <input type="text" id="billLadingNumber" placeholder="Enter bill of lading number"><br>
    <label>Carrier Name:</label>
    <input type="text" id="carrierName" placeholder="Enter carrier name"><br>
    <label>SCAC:</label>
    <input type="text" id="scac" placeholder="Enter SCAC"><br>

    <h3>Weight, PKGS, and Shipper Info:</h3>
    <div id="dynamicFields">
      <!-- Динамічні поля будуть додані тут -->
    </div>
    <button type="button" id="addField">Add Shipper Info</button><br><br>

    <button type="button" id="generate">Генерувати PDF</button>
  </form>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dynamicFieldsContainer = document.getElementById('dynamicFields');
      const addFieldButton = document.getElementById('addField');
      let counter = 2; // Лічильник для додавання нових полів

      // Додавання нових полів за кнопкою
      addFieldButton.addEventListener('click', () => {
        if (counter <= 8) {
          const fieldSet = document.createElement('div');
          fieldSet.innerHTML = `
            <label>Weight ${counter}:</label>
            <input type="text" id="weight${counter}" placeholder="Enter weight ${counter}"><br>
            <label>PKGS ${counter}:</label>
            <input type="text" id="pkgs${counter}" placeholder="Enter PKGS ${counter}"><br>
            <label>Shipper Info ${counter}:</label>
            <input type="text" id="shipperInfo${counter}" placeholder="Enter Shipper Info ${counter}"><br>
          `;
          dynamicFieldsContainer.appendChild(fieldSet);
          counter++;
        } else {
          alert('Maximum 8 fields allowed.');
        }
      });

      document.getElementById('generate').addEventListener('click', async () => {
        const templateUrl = 'template.pdf'; // Замініть на правильний шлях до шаблона
        const arrayBuffer = await fetch(templateUrl).then(res => res.arrayBuffer());
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        const form = pdfDoc.getForm();

        const fields = [
          'shipFromAddress', 'shipFromCity', 'shipFromName', 'shipFromSID',
          'shipToAddress', 'shipToCity', 'shipToName', 'shipToSID',
          'pkgs', 'weight', 'shipperInfo', 'billLadingNumber',
          'carrierName', 'scac'
        ];

        // Заповнення основних полів
        fields.forEach(field => {
          const value = document.getElementById(field)?.value || '';
          if (form.getTextField(field)) {
            form.getTextField(field).setText(value);
          }
        });

        // Заповнення динамічних полів
        for (let i = 2; i < counter; i++) {
          ['weight', 'pkgs', 'shipperInfo'].forEach(field => {
            const fieldName = `${field}${i}`;
            const value = document.getElementById(fieldName)?.value || '';
            if (form.getTextField(fieldName)) {
              form.getTextField(fieldName).setText(value);
            }
          });
        }

        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'Filled_BOL.pdf';
        link.click();
      });
    });
  </script>
</body>
</html>
